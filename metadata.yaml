# Copyright 2023 Canonical Ltd.
# See LICENSE file for licensing details.

name: wazuh-indexer
display-name: Wazuh Indexer

description: |
  The Wazuh indexer is a highly scalable, full-text search and analytics engine.
  This Wazuh central component indexes and stores alerts generated by the Wazuh
  server and provides near real-time data search and analytics capabilities.
summary: |
  The Charmed Wazuh Indexer operator
link:
  contact: https://launchpad.net/~canonical-is-devops
  issues: https://github.com/canonical/wazuh-indexer-operator/issues
  source: https://github.com/canonical/wazuh-indexer-operator

docs: https://discourse.charmhub.io/t/wazuh-indexer-documentation-overview/16071

peers:
  opensearch-peers:
    interface: opensearch_peers
  node-lock-fallback:
    interface: node_lock_fallback
  upgrade-version-a:
    # Relation versioning scheme:
    # DA056 - Upgrading in-place upgrade protocol
    # https://docs.google.com/document/d/1H7qy5SAwLiCOKO9xMQJbbQP5_-jGV6Lhi-mJOk4gZ08/edit
    interface: upgrade

provides:
  peer-cluster-orchestrator:
    interface: peer_cluster
    optional: true
  opensearch-client:
    interface: opensearch_client
  cos-agent:
    description: |
      `cos-agent` is a dedicated relation for the grafana agent machine
      charm. It will allow you to set up custom scrape jobs, fetch files
      from arbitrary locations, send alert rules, dashboards, etc.
    interface: cos_agent
    scope: container

requires:
  certificates:
    interface: tls-certificates
    limit: 1
  peer-cluster:
    interface: peer_cluster
    limit: 2  # (main+failover)_cluster_orchestrator(s)
    optional: true
  s3-credentials:
    interface: s3
    limit: 1
  azure-credentials:
    interface: azure
    limit: 1
  oauth:
    interface: oauth
    limit: 1
    optional: true

storage:
  opensearch-data:
    type: filesystem
    location: /var/snap/wazuh-indexer/common  # /mnt/opensearch/data
